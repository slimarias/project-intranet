<template>
	<div class="row q-col-gutter-x-md">
		<div v-for="(user, key) in users" :key="key" class="col-xs-6 col-sm-6 col-md-4 col-lg-3 q-mb-md">
			<div class="flex flex-center q-mx-md q-my-md">
				<q-avatar size="100px" class="relative-position">
					<q-img :src="user.mainImage" :ratio="1" />
					<q-btn
						round
						size="xs"
						color="primary"
						class="absolute-bottom-right" @click="()=>{ selectedUser = user;showModal=true }">
						<q-icon name="fas fa-external-link-alt"/>
					</q-btn>
				</q-avatar>
			</div>
			<div class="flex text-center text-grey-7 text-bold text-caption">
				{{ (user.fullName).substr(0,15)}}
			</div>
			<div class="flex flex-center" v-if="false">
				<hr width="25%">
			</div>
			<div class="flex flex-center" v-if="false">
			</div>
		</div>
		<userProfileModal :user="selectedUser" v-model="showModal" v-if="selectedUser"/>
	</div>
</template>

<script>
	import userProfileModal from "./userProfileModal";
	
  export default {
    name: "usersGrid",
	  components:{
      userProfileModal
	  },
    limit:{
      type: String,
      default: '8'
    },
	  data(){
      return{
        loading: false,
		showModal: false,
		selectedUser: {},
	    users: [],
        page: 1,
        take: 20,
        lastPage: 1,
      }
	  },
    mounted() {
	    this.$nextTick( () => {
	      this.getUsers()
	    })
	},
	computed:{
		defaultFields () {
			return [
				{ name: 'cellularPhone', value: null },
				{ name: 'birthday', value: null },
				{ name: 'identification', value: null },
				{ name: 'mainImage', value: {} },
				{ name: 'email', value: null },
				{ name: 'socialNetworks', value: [] },
				{ name: 'contacts', value: [] },
				{ name: 'products', value: [] }
			]
		}
	},
	methods:{
      getUsers(){
        this.loading = true
        const params = {
          params: {
            filter: {},
	          include: 'addresses',
            page: this.page,
            take: 8,
          }
        }
        this.$crud.index('apiRoutes.quser.users', params)
          .then( response => {
			let resp = this.$clone(response.data)
			for(let x in resp){
			  resp[x].fields = this.$helper.convertToFrontField(this.defaultFields,resp[x].fields)
			}
			this.users.push(...resp)
            this.take = response.meta.page.perPage
            this.lastPage = response.meta.page.lastPage
            this.loading = false
          })
          .catch( error => {
            this.$alert.error({message: this.$tr('ui.message.errorRequest'), pos: 'bottom'})
            this.loading = false
          })
      },
      getMorePosts(){
        this.page = this.page + 1
        this.getUsers()
      },
	  }
  }
</script>

<style scoped>

</style>