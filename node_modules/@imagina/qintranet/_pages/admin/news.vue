<template>
	<q-page>
		<q-card class="row  custom-border-radius">
			<section class="col-xs-12 col-md-9 relative-position q-pa-md">				<div class="text-body1 text-grey-6 text-bold q-py-md q-ml-sm q-mr-xl border-botton-grey">
					NOTICIAS

				</div>
				<q-btn
					round
					color="primary"
					class="absolute-top-right q-mt-md q-mr-md btn-shadow">
					<q-icon
						name="far fa-newspaper"
						size="xs"/>
				</q-btn>
				<postGrid :categories="categories" limit="12" height="700" class="q-mt-md"/>
			</section>
			<section class="col-md-3 q-pa-none">
				<listCategories />
			</section>
		</q-card>
	</q-page>
</template>

<script>
	import postGrid from '../../_components/postsGrid'
	import listCategories  from '../../_components/qblog/list-categories'
  export default {
    name: "news",

	components:{
      postGrid,
      listCategories,
	},
	data(){
    	return{
    		slug: null,
			categories: [],
			category: {},
		}
	},
	mounted(){
        this.$root.$on('page.data.refresh', () => this.getData(true))
        this.$root.$on('page.data.refresh', () => this.getCategory(true))
    	this.getCategory(true)
	},
	watch:{
    	'$route.params.category'(){
    		this.getCategory(true)
		}
	},
	methods:{
		getCategory(refresh){
			this.slug = this.$route.params.category || null
			let params = {
				refresh: refresh,
				params: {},
			}
			if(this.slug !== null) {
				params.params = {
					filter: {
						field: isNaN(this.slug) ? 'slug' : 'id',
					}
				}
				this.$crud.show('apiRoutes.qblog.categories', this.slug, params)
					.then(response => {
						//this.$helper.array.builTree
						this.categories = [response.data.id]
						this.category = response.data
					})
					.catch(error => {
						this.categories = []
						this.category = {}
						this.$alert.error({message: 'Error', timeOut: 4000})
					})
			}else{
				this.categories = []
				this.categoy = {}
			}
		},
	}
  }
</script>

<style scoped>
	.border-botton-grey{
		border-bottom: 1px solid #9e9e9e52
	}
</style>